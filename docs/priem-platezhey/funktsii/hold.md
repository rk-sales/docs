# Холдирование платежей

Холдирование (предавторизация) — это двухэтапный платёж по карте, при котором деньги сначала **блокируются** на счёте клиента, а затем вы отдельно решаете, **списать** их или **освободить**.  
В Robokassa холдирование настраивается через API и используется для онлайн‑платежей по картам.

## Зачем нужно холдирование

- Проверить наличие товара или услугу перед окончательным списанием.
- Забронировать сумму на карте клиента (отели, аренда, бронирования).
- Учесть возможные изменения суммы: доп.услуги, пересчёт доставки, частичный отказ.
- Снизить количество возвратов: сначала проверяете заказ, потом уже списываете деньги.

При холде клиент видит, что средства «заморожены», но пока не списаны окончательно.

## Как работает холд в Robokassa

### 1. Предавторизация (блокировка средств)

1. Вы создаёте платёж через API Robokassa как обычную оплату по карте.
2. В запрос добавляете параметр `StepByStep=true` и учитываете его при формировании подписи.
3. Клиент проходит стандартный сценарий оплаты (карта, 3‑D Secure).
4. Деньги на карте **блокируются**, но не зачисляются на ваш счёт.

После успешной предавторизации Robokassa отправляет уведомление на ваш `ResultURL` (или отдельный `ResultURL2`, если так настроено), а в личном кабинете платёж помечается как «холд».

### 2. Подтверждение или отмена

Пока холд активен (обычно до 7 календарных дней):

- Чтобы **списать средства**, вы отправляете запрос подтверждения через API (endpoint подтверждения, параметры: логин, сумма, номер счёта/InvoiceId, подпись).
- Чтобы **отменить холд**, отправляете запрос на отмену — заблокированная сумма полностью освобождается на карте клиента.
- Возможна **частичная captura**: списать только часть суммы, а остаток автоматически вернётся на карту.

Если вы не отправите ни подтверждение, ни отмену, по истечении срока холда блокировка снимается автоматически.

## Типичный сценарий работы магазина

1. Клиент оформляет заказ и оплачивает его по карте с холдированием.
2. Вы получаете уведомление о предавторизации и проверяете заказ: наличие товара, корректность цены, отсутствие фрода.
3. Если всё в порядке — вызываете метод подтверждения и списываете средства.
4. Если заказ отменён или изменить его нельзя — выполняете отмену холда, и деньги возвращаются клиенту без отдельного возврата.

## Подключение холдирования

- Функция холдирования включается **дополнительно** по запросу через менеджера или поддержку Robokassa.
- После активации вы:
  - добавляете параметр `StepByStep=true` в создание платежа;
  - реализуете обработку уведомлений по холду;
  - настраиваете вызовы API для подтверждения и отмены.

В результате вы получаете гибкий инструмент: деньги не списываются автоматически, а переходят под ваш контроль до финального решения по заказу.
